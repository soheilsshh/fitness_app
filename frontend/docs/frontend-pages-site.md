## سایت عمومی (`(site)`)

در این بخش صفحات سمت وب‌سایت عمومی (landing + auth + پرداخت) و نیازمندی‌های بک‌اند برای هر کدام توضیح داده شده است.

---

### صفحه خانه / لندینگ

- **Route**: `/`
- **فایل**: `src/app/(site)/page.js`
- **کامپوننت‌ها**:
  - `Navbar`
  - `Hero`
  - `ProgramsSection`
  - `RecordsSection`
  - `AboutSection`
  - `ContactSection`
  - `Footer`

#### رفتار کلی

- صفحه لندینگ تک‌صفحه‌ای با سکشن‌های اسکرول داخلی (`id="home"`, `id="programs"`, `id="records"`, `id="contact"` و غیره).
- ناوبری اصلی از طریق `Navbar` انجام می‌شود (لینک‌های اسکرول به سکشن‌ها + دکمه ورود/ثبت‌نام).
- سکشن‌ها فعلاً از داده‌های ثابت استفاده می‌کنند ولی ساختار آن‌ها طوری است که به‌راحتی می‌توان آن را به API متصل کرد.

#### نیازمندی‌های بک‌اند (پیشنهادی)

- در صورت داینامیک‌کردن محتوا:
  - Endpoint برای **تنظیمات صفحه اصلی** (در حال حاضر در `defaultSiteSettings` نگه داشته می‌شود):
    - GET `/site-settings` → خواندن تنظیمات فعلی.
    - PUT `/site-settings` → ذخیره تنظیمات (استفاده از فرم ادمین در `/admin/site`).
  - Endpoint برای **پلن‌های قابل‌خرید**:
    - GET `/plans/public` → لیست پلن‌هایی که در لندینگ نمایش داده می‌شوند (استقاده در `ProgramsSection` به جای آرایه ثابت `PLANS`).

---

### سکشن برنامه‌ها (ProgramsSection)

- **کامپوننت**: `src/app/(site)/_components/ProgramsSection.js`
- **داده فعلی**:
  - آرایه ثابت `PLANS` با فیلدهای:
    - `id`, `title`, `subtitle`, `desc`, `price`, `oldPrice`, `features[]`, `highlighted?`.
- **رفتار**:
  - نمایش کارت‌های پلن با قیمت فعلی، قیمت قبلی (در صورت وجود) و محاسبه درصد تخفیف.
  - دکمه «افزودن به سبد خرید» روی هر کارت:
    - روی کلیک، اکشن `addToCart({ id, title, price })` روی Redux dispatch می‌شود.
    - از اسلایس `cartSlice` برای نگهداری مقادیر استفاده می‌شود.

#### نیازمندی‌های بک‌اند

- **مدل پلن** باید با چیزی که در پنل ادمین و اینجا استفاده می‌شود هم‌راستا باشد (به overview مراجعه کنید).
- Endpointهای احتمالی:
  - GET `/plans/public` → لیست پلن‌های فعال برای فروش (فقط برخی فیلدهای عمومی، بدون داده‌های مدیریتی).
  - اینکه اطلاعات تخفیف (`oldPrice`, `discountPercent`) در چه فیلدی نگه داشته شود باید در مدل پلن نهایی مشخص شود.

---

### سکشن رکوردها و آمار (RecordsSection)

- **کامپوننت**: `src/app/(site)/_components/RecordsSection.js`
- **داده فعلی**:
  - آرایه ثابت `STATS` با فیلدهای:
    - `icon`, `value` (مثل `"12,500+"`)، `label` (مثل `"کاربر فعال"`).
  - سه کارت توضیحی (ثبت پیشرفت، تحلیل روند، پایداری نتیجه) که به صورت آرایه inline در همان فایل نوشته شده‌اند.

#### نیازمندی‌های بک‌اند

- در صورت داینامیک‌کردن آمار:
  - API برای **آمار سایت** که می‌تواند هم‌راستا با `defaultSiteSettings.stats` در ادمین باشد:
    - GET `/site-metrics` → بازگرداندن `[{ id, value, label }]`.
  - امکان ویرایش از طریق `/admin/site` (همان endpoint که برای site settings استفاده می‌شود).

---

### سکشن درباره و تماس (AboutSection, ContactSection, Footer, Navbar, Hero)

- فعلاً تمام این بخش‌ها با داده‌های ثابت و UI آماده شده‌اند.
- ادمین `/admin/site` قابلیت مدیریت **feature bullets**، **stats**، **steps** و **contactInfo** را دارد؛ این یعنی بک‌اند باید:
  - یک مدل `SiteSettings` (یا مشابه) داشته باشد که همین مقادیر را نگه‌داری کند.
  - Endpointهای:
    - GET `/site-settings`
    - PUT `/site-settings`
  را پیاده‌سازی کند تا فرم ادمین بتواند داده را لود و ذخیره کند.

---

## صفحات احراز هویت (`/auth/*`)

سه صفحه زیر همگی از لایوت `AuthLayout` و شِل `AuthShell` استفاده می‌کنند و درون یک کارت auth در مرکز صفحه نمایش داده می‌شوند.

### صفحه لاگین

- **Route**: `/auth/login`
- **فایل**: `src/app/(site)/auth/login/page.js` → تنها `LoginForm` را رندر می‌کند.
- **فرم**: `src/app/(site)/auth/login/_components/LoginForm.js` (اینجا فقط رفتار کلی را توصیف می‌کنیم):
  - فیلدهای احتمالی: شماره موبایل / ایمیل، رمز عبور یا OTP (بسته به پیاده‌سازی).
  - استفاده از SweetAlert2 / پیام‌های موفق/خطا محتمل است (بسته به کد داخلی).

#### نیازمندی‌های بک‌اند (پیشنهادی)

- Endpoint برای ورود:
  - POST `/auth/login`
    - بدنه پیشنهادی: `{ phoneOrEmail: string, password?: string, otp?: string }`
    - خروجی: `{ user: User, accessToken: string, refreshToken?: string }`
  - اگر از OTP استفاده می‌شود:
    - POST `/auth/send-otp` → ارسال کد برای موبایل.
    - POST `/auth/verify-otp` → تأیید کد.
- مدیریت سشن:
  - ذخیره توکن در کوکی HttpOnly یا localStorage (با توجه به استراتژی امنیتی).

---

### صفحه ثبت‌نام

- **Route**: `/auth/register`
- **فایل**: `src/app/(site)/auth/register/page.js` → `RegisterForm`.
- **فرم** (`RegisterForm.js`):
  - شامل فیلدهای اطلاعات اولیه (نام، موبایل، رمز عبور و ...).

#### نیازمندی‌های بک‌اند

- Endpoint:
  - POST `/auth/register`
    - ورودی: اطلاعات پایه کاربر (مطابق مدل `User` در overview + رمز).
    - خروجی: کاربر + توکن (در صورت لاگین خودکار بعد از ثبت‌نام).
- اعتبارسنجی:
  - یکتا بودن شماره موبایل.
  - الزامات رمز عبور.

---

### صفحه فراموشی رمز

- **Route**: `/auth/forgot`
- **فایل**: `src/app/(site)/auth/forgot/page.js` → `ForgotForm`.

#### نیازمندی‌های بک‌اند

- دو رویکرد متداول:
  - **OTP با موبایل**:
    - POST `/auth/forgot/send-otp` → ارسال پیامک برای شماره ثبت‌شده.
    - POST `/auth/forgot/verify-otp` → تأیید و دریافت توکن موقت برای ریست رمز.
    - POST `/auth/forgot/reset` → ست‌کردن رمز جدید.
  - **لینک ایمیل**:
    - POST `/auth/forgot` → ارسال لینک حاوی توکن.
    - POST `/auth/reset` → دریافت رمز جدید با توکن.

---

## پرداخت و سبد خرید

### سبد خرید (Redux + UI)

- **State**:
  - آرایه `items` در `cartSlice` که از `ProgramsSection` و سایر بخش‌ها پر می‌شود.
  - آیتم‌ها ساختار `{ id, title, price, qty }` دارند.

- **UIهای مرتبط**:
  - `CartButton`:
    - در `Navbar` دیده می‌شود، تعداد آیتم‌ها و جمع کل را نمایش می‌دهد.
    - روی hover یک preview کوچک از آیتم‌ها را نمایش می‌دهد.
    - روی کلیک، `CartDrawer` را باز می‌کند.
  - `CartDrawer`:
    - امکان افزایش/کاهش تعداد، حذف آیتم و مشاهده جمع کل.
    - دکمه «ثبت سفارش» که به `/payment` لینک می‌دهد.

#### نیازمندی‌های بک‌اند

- در لحظه ثبت سفارش (روی `/payment`):
  - لازم است سبد خرید سمت سرور معتبرسازی شود:
    - بررسی وجود پلن‌ها.
    - بررسی قیمت/تخفیف فعلی (جلوگیری از دستکاری قیمت در فرانت).
  - ممکن است نیاز به مدل موقت «Cart» در سرور یا تبدیل مستقیم Cart به Order وجود داشته باشد.

---

### صفحه پرداخت (`/payment`)

- **Route**: `/payment`
- **فایل**: `src/app/(site)/payment/page.js` → `PaymentClient`.
- **کامپوننت**: `PaymentClient` (در `src/app/(site)/_components/PaymentClient.js`):
  - از Redux سبد خرید استفاده می‌کند.
  - نمایش خلاصه آیتم‌ها، انتخاب روش پرداخت (احتمالاً در UI) و دکمه ادامه به درگاه بانکی.

#### نیازمندی‌های بک‌اند

- Endpoint ساخت پیش‌فاکتور/سفارش:
  - POST `/orders/checkout`
    - ورودی:
      - `items: Array<{ planId: string; qty: number }>`
      - اطلاعات کاربر (از توکن) + شاید کوپن تخفیف.
    - خروجی:
      - `orderId: string`
      - `amount: number`
      - `paymentGatewayUrl?: string` (اگر درگاه بانک خارجی است).
  - اگر درگاه بانکی داخلی باشد:
    - هدایت کاربر به `/payment/bank` (صفحه داخلی که نقش شبیه‌سازی دارد، ولی در نسخه واقعی redirect به URL بانک خواهد بود).

---

### صفحه درگاه بانکی (دمو)

- **Route**: `/payment/bank`
- **فایل**: `src/app/(site)/payment/bank/page.js`
- **رفتار**:
  - فقط یک UI دمو نشان می‌دهد که می‌گوید «در نسخه واقعی، اینجا به URL بانک redirect می‌شوید».

#### نیازمندی‌های بک‌اند

- در نسخه واقعی، گردش کار معمولاً این‌طور است:
  - فرانت بعد از دریافت `paymentGatewayUrl` از `/orders/checkout` کاربر را به بانک redirect می‌کند.
  - بانک بعد از پرداخت موفق/ناموفق، کاربر را به یک callback مثل `/payment/callback` برمی‌گرداند.
  - بک‌اند در `/payment/callback`:
    - وضعیت پرداخت را از بانک استعلام می‌کند.
    - سفارش را به `status="paid" | "failed"` به‌روزرسانی می‌کند.
  - فرانت می‌تواند بر اساس وضعیت نهایی کاربر را به صفحه‌ای مثل `/user/orders/[id]` هدایت کند. 

